<% content_for :title, @post.title %>

<article class="post-show">
  <header class="post-show-header">
    <h1 class="post-show-title"><%= @post.title %></h1>
    <p class="post-show-meta">
      By <strong><%= @post.user.name %></strong> &middot; 
      <%= @post.created_at.strftime("%B %d, %Y") %>
    </p>
  </header>

  <div class="post-show-body">
    <%= simple_format(@post.body) %>
  </div>

  <% if user_signed_in? && @post.user == current_user %>
    <div class="post-actions">
      <%= link_to "Edit", edit_post_path(@post), class: "btn-primary" %>
      <%= button_to "Delete", @post, method: :delete, class: "btn-danger", data: { turbo_confirm: "Are you sure you want to delete this post?" } %>
    </div>
  <% end %>

  <section class="comments-section">
    <h3>Comments (<%= @post.comments.count %>)</h3>

    <% @post.comments.includes(:user).order(created_at: :asc).each do |comment| %>
      <div class="comment">
        <div class="comment-header">
          <span class="comment-author"><%= comment.user.name %></span>
          <span class="comment-date"><%= time_ago_in_words(comment.created_at) %> ago</span>
        </div>
        <div class="comment-body">
          <%= simple_format(comment.body) %>
        </div>
        <% if user_signed_in? && comment.user == current_user %>
          <div style="margin-top: 0.75rem;">
            <%= button_to "Delete", post_comment_path(@post, comment), method: :delete, class: "btn-danger", data: { turbo_confirm: "Delete this comment?" } %>
          </div>
        <% end %>
      </div>
    <% end %>

    <% if user_signed_in? %>
      <div class="comment-form">
        <h4>Leave a Comment</h4>
        <%= form_with model: [@post, Comment.new] do |form| %>
          <div class="form-group">
            <%= form.text_area :body, placeholder: "Write your comment...", rows: 4 %>
          </div>
          <div class="form-actions">
            <%= form.submit "Post Comment", class: "btn-primary" %>
          </div>
        <% end %>
      </div>
    <% else %>
      <p style="color: var(--color-text-muted); margin-top: 1.5rem;">
        <%= link_to "Sign in", new_user_session_path %> to leave a comment.
      </p>
    <% end %>
  </section>

  <div style="margin-top: 3rem;">
    <%= link_to "â† Back to Posts", posts_path %>
  </div>
</article>
